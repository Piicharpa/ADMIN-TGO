"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[700],{6700:function(e,t,i){i.r(t),i.d(t,{default:function(){return v}});var n=i(9268),l=i(3702),s=i(8298),a=i(8176),r=i(315),o=i(8958),c=i(6006),d=i(4390),u=i(5942),_=e=>{let{visible:t,unit:i,submitted:s,onHide:a,onSave:o,onChange:c}=e,_=(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(l.z,{label:"ยกเลิก",icon:"pi pi-times",outlined:!0,onClick:a}),(0,n.jsx)(l.z,{label:"บันทึก",icon:"pi pi-check",onClick:o})]});return(0,n.jsxs)(d.V,{visible:t,style:{width:"500px"},header:"รายละเอียดหน่วย",modal:!0,className:"p-fluid",footer:_,onHide:a,children:[(0,n.jsxs)("div",{className:"field mt-3",children:[(0,n.jsx)("label",{className:"font-bold",children:"ชื่อหน่วย (TH) *"}),(0,n.jsx)(r.o,{value:(null==i?void 0:i.product_unit_name_th)||"",onChange:e=>c(e,"product_unit_name_th"),className:(0,u.AK)({"p-invalid":s&&!(null==i?void 0:i.product_unit_name_th)})})]}),(0,n.jsxs)("div",{className:"field mt-3",children:[(0,n.jsx)("label",{className:"font-bold",children:"ชื่อหน่วย (EN) *"}),(0,n.jsx)(r.o,{value:(null==i?void 0:i.product_unit_name_en)||"",onChange:e=>c(e,"product_unit_name_en"),className:(0,u.AK)({"p-invalid":s&&!(null==i?void 0:i.product_unit_name_en)})})]}),(0,n.jsxs)("div",{className:"field mt-3",children:[(0,n.jsx)("label",{className:"font-bold",children:"รหัสย่อ (TH)"}),(0,n.jsx)(r.o,{value:(null==i?void 0:i.product_unit_abbr_th)||"",onChange:e=>c(e,"product_unit_abbr_th")})]}),(0,n.jsxs)("div",{className:"field mt-3",children:[(0,n.jsx)("label",{className:"font-bold",children:"รหัสย่อ (EN)"}),(0,n.jsx)(r.o,{value:(null==i?void 0:i.product_unit_abbr_eng)||"",onChange:e=>c(e,"product_unit_abbr_eng")})]})]})},h=i(2494);let p="http://178.128.123.212:5000/api/v1/admin/units";function m(e){return{product_unit_id:e.product_unit_id,product_unit_name_th:e.product_unit_name_th,product_unit_name_en:e.product_unit_name_en,product_unit_abbr_th:e.product_unit_abbr_th,product_unit_abbr_eng:e.product_unit_abbr_eng}}let f={getUnits:()=>fetch(p,{headers:{"Cache-Control":"no-cache"}}).then(e=>e.ok?e.json():Promise.reject(e)).then(e=>e.map(m)),getUnitById:e=>fetch("".concat(p,"/").concat(e),{headers:{"Cache-Control":"no-cache"}}).then(e=>e.ok?e.json():Promise.reject(e)).then(m),createUnit:e=>fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.ok?e.json():Promise.reject(e)).then(m),updateUnit:e=>fetch("".concat(p,"/").concat(e.product_unit_id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.ok?e.json():Promise.reject(e)).then(m),deleteUnit:e=>fetch("".concat(p,"/").concat(e),{method:"DELETE"}).then(e=>e.ok?e.json():Promise.reject(e))};var v=()=>{let[e,t]=(0,c.useState)([]),[i,d]=(0,c.useState)(null),[u,p]=(0,c.useState)(null),[m,v]=(0,c.useState)(!1),[x,j]=(0,c.useState)(""),[y,b]=(0,c.useState)(""),[g,w]=(0,c.useState)(!1),[N,C]=(0,c.useState)(!1),[S,k]=(0,c.useState)(!1),[E,U]=(0,c.useState)(!1),P=(0,c.useRef)(null),T=(0,c.useRef)(null);(0,c.useEffect)(()=>{z()},[]);let z=async()=>{v(!0);try{let e=await f.getUnits();t(e)}catch(t){var e;null===(e=P.current)||void 0===e||e.show({severity:"error",summary:"Error",detail:"ไม่สามารถโหลดข้อมูลได้",life:3e3})}finally{v(!1)}},H=e.filter(e=>{var t;return null===(t=e.product_unit_name_th)||void 0===t?void 0:t.toLowerCase().includes(y.toLowerCase())}),O=async()=>{var n,l,s;if(U(!0),i&&i.product_unit_name_th.trim()){v(!0);try{if(i.product_unit_id&&i.product_unit_id>0){let l=await f.updateUnit(i);t(e.map(e=>e.product_unit_id===l.product_unit_id?l:e)),null===(n=P.current)||void 0===n||n.show({severity:"success",summary:"สำเร็จ",detail:"แก้ไขข้อมูลแล้ว",life:3e3})}else{let n=await f.createUnit(i);t([...e,n]),null===(l=P.current)||void 0===l||l.show({severity:"success",summary:"สำเร็จ",detail:"เพิ่มหน่วยแล้ว",life:3e3})}z(),w(!1),d(null)}catch(e){null===(s=P.current)||void 0===s||s.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{v(!1)}}},L=e=>{d({...e}),w(!0)},A=e=>{d(e),C(!0)},K=async()=>{var n,l;if(i){v(!0);try{await f.deleteUnit(i.product_unit_id),t(e.filter(e=>e.product_unit_id!==i.product_unit_id)),null===(n=P.current)||void 0===n||n.show({severity:"success",summary:"สำเร็จ",detail:"ลบข้อมูลแล้ว",life:3e3})}catch(e){null===(l=P.current)||void 0===l||l.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{C(!1),d(null),v(!1)}}},M=async()=>{var i,n;if(u){v(!0);try{await Promise.all(u.map(e=>f.deleteUnit(e.product_unit_id))),t(e.filter(e=>!u.includes(e))),null===(i=P.current)||void 0===i||i.show({severity:"success",summary:"สำเร็จ",detail:"ลบข้อมูลที่เลือกแล้ว",life:3e3})}catch(e){null===(n=P.current)||void 0===n||n.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{k(!1),p(null),v(!1)}}};return(0,n.jsx)("div",{className:"grid",children:(0,n.jsx)("div",{className:"col-12",children:(0,n.jsxs)("div",{className:"card p-4",children:[(0,n.jsx)(o.F,{ref:P}),(0,n.jsxs)("div",{className:"flex flex-column md:flex-row md:justify-content-between md:align-items-center gap-3",children:[(0,n.jsx)("h2",{className:"m-0",children:"จัดการหน่วย"}),(0,n.jsxs)("div",{className:"flex flex-column md:flex-row gap-3",children:[(0,n.jsxs)("span",{className:"p-input-icon-left mr-3",children:[(0,n.jsx)("i",{className:"pi pi-search"}),(0,n.jsx)(r.o,{type:"search",placeholder:"ค้นหาด้วยชื่อ...",value:y,onChange:e=>b(e.target.value),className:"w-full"})]}),(0,n.jsx)(l.z,{label:"เพิ่มหน่วย",icon:"pi pi-plus",severity:"success",onClick:()=>{d({product_unit_id:0,product_unit_name_th:"",product_unit_name_en:"",product_unit_abbr_th:"",product_unit_abbr_eng:""}),U(!1),w(!0)}})]})]}),(0,n.jsxs)(a.w,{ref:T,value:H,selection:u,onSelectionChange:e=>p(e.value),dataKey:"product_unit_id",paginator:!0,rows:10,rowsPerPageOptions:[5,10,25],globalFilter:x,emptyMessage:"ไม่พบข้อมูล",loading:m,responsiveLayout:"scroll",className:"mt-4",header:u&&u.length>0?(0,n.jsxs)("div",{className:"flex justify-content-between align-items-center",children:[(0,n.jsx)("span",{children:"เลือก ".concat(u.length," รายการ")}),(0,n.jsx)(l.z,{label:"ลบที่เลือก",icon:"pi pi-trash",severity:"danger",onClick:()=>k(!0)})]}):null,selectionMode:u?"checkbox":null,children:[(0,n.jsx)(s.s,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),(0,n.jsx)(s.s,{field:"index",header:"ลำดับ",body:(e,t)=>{let{rowIndex:i}=t;return i+1},style:{width:"200px"}}),(0,n.jsx)(s.s,{field:"product_unit_name_th",header:"ชื่อหน่วยภาษาไทย",sortable:!0,style:{width:"200px"}}),(0,n.jsx)(s.s,{field:"product_unit_name_en",header:"ชื่อหน่วยภาษาอังกฤษ",sortable:!0,style:{width:"200px"}}),(0,n.jsx)(s.s,{field:"product_unit_abbr_th",header:"ชื่อย่อหน่วยภาษาไทย",sortable:!0,style:{width:"200px"}}),(0,n.jsx)(s.s,{field:"product_unit_abbr_eng",header:"ชื่อย่อหน่วยภาษาอังกฤษ",sortable:!0,style:{width:"200px"}}),(0,n.jsx)(s.s,{body:e=>(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)(l.z,{icon:"pi pi-pencil",rounded:!0,severity:"success",onClick:()=>L(e),tooltip:"แก้ไข",tooltipOptions:{position:"top"}}),(0,n.jsx)(l.z,{icon:"pi pi-trash",rounded:!0,severity:"danger",onClick:()=>A(e),tooltip:"ลบ",tooltipOptions:{position:"top"}})]}),header:"การดำเนินการ",headerStyle:{width:"100px"},bodyStyle:{textAlign:"center"}})]}),(0,n.jsx)(_,{visible:g,unit:i,submitted:E,onHide:()=>{U(!1),w(!1)},onSave:O,onChange:(e,t)=>{let i=e.target.value;d(e=>e?{...e,[t]:i}:null)}}),(0,n.jsx)(h.Z,{visible:N,onHide:()=>C(!1),onConfirm:K,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(null==i?void 0:i.product_unit_name_th," รายการที่เลือก?")}),(0,n.jsx)(h.Z,{visible:S,onHide:()=>k(!1),onConfirm:M,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(null==u?void 0:u.length," รายการที่เลือก?")})]})})})}}}]);