"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{3512:function(e,a,t){t.r(a),t.d(a,{default:function(){return j}});var l=t(9268),s=t(3702),r=t(8298),i=t(8176),n=t(315),c=t(8958),o=t(4390),d=t(5942),p=t(1262),u=t(3142),m=t(6006);function h(e){let{visible:a,pcr:t,submitted:r,onHide:i,onChange:c,onSave:u}=e,m=(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,l.jsx)(s.z,{label:"ยกเลิก",icon:"pi pi-times",outlined:!0,onClick:i}),(0,l.jsx)(s.z,{label:"บันทึก",icon:"pi pi-check",onClick:u})]});return(0,l.jsxs)(o.V,{visible:a,style:{width:"500px"},header:"รายละเอียด PCR",modal:!0,className:"p-fluid",footer:m,onHide:i,children:[(0,l.jsxs)("div",{className:"field mt-3",children:[(0,l.jsx)("label",{htmlFor:"pcr_name",className:"font-bold",children:"ชื่อ PCR *"}),(0,l.jsx)(n.o,{id:"pcr_name",value:t.pcr_name,onChange:e=>c(e,"pcr_name"),required:!0,autoFocus:!0,className:(0,d.AK)({"p-invalid":r&&!t.pcr_name}),placeholder:"กรอกชื่อ PCR"}),r&&!t.pcr_name&&(0,l.jsx)("small",{className:"p-error",children:"จำเป็นต้องกรอกชื่อ PCR"})]}),(0,l.jsxs)("div",{className:"field mt-3",children:[(0,l.jsx)("label",{htmlFor:"approval_date",className:"font-bold",children:"วันที่อนุมัติ"}),(0,l.jsx)(p.f,{value:(null==t?void 0:t.approval_date)?new Date(t.approval_date):null,onChange:e=>c({value:e.value},"approval_date"),locale:"th-TH",showIcon:!0,dateFormat:"dd/mm/yy"}),r&&!(null==t?void 0:t.approval_date)&&(0,l.jsx)("small",{className:"p-error",children:"จำเป็นต้องเลือกวันเริ่มต้น"})]}),(0,l.jsxs)("div",{className:"field mt-3",children:[(0,l.jsx)("label",{htmlFor:"pcr_type",className:"font-bold",children:"ประเภท PCR"}),(0,l.jsx)(n.o,{id:"pcr_type",value:t.pcr_type,onChange:e=>c(e,"pcr_type"),placeholder:"กรอกประเภท PCR"})]})]})}(0,u.b4)("th-TH",{firstDayOfWeek:0,dayNames:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"],dayNamesShort:["อา","จ","อ","พ","พฤ","ศ","ส"],dayNamesMin:["อา","จ","อ","พ","พฤ","ศ","ส"],monthNames:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],monthNamesShort:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],today:"วันนี้",clear:"ลบ"});var y=t(2494),v=t(447);let f="http://178.128.123.212:5000/api/v1/admin/pcrs",x={getPCRs:async()=>{let e=await v.Z.get(f);return e.data},getPCRById:async e=>{let a=await v.Z.get("".concat(f,"/").concat(e));return a.data},createPCR:async e=>{let a=await v.Z.post(f,e);return a.data},updatePCR:async(e,a)=>{let t=await v.Z.put("".concat(f,"/").concat(e),a);return t.data},deletePCR:async e=>{await v.Z.delete("".concat(f,"/").concat(e))}};var j=()=>{let e={id:0,pcr_name:"",approval_date:"",pcr_type:"",pcr_type_id:0},[a,t]=(0,m.useState)([]),[o,d]=(0,m.useState)(!1),[p,u]=(0,m.useState)(null),[v,f]=(0,m.useState)(!1),[j,_]=(0,m.useState)(!1),[C,w]=(0,m.useState)(!1),[g,N]=(0,m.useState)(e),[b,P]=(0,m.useState)(!1),[R]=(0,m.useState)(""),[S,k]=(0,m.useState)(""),E=(0,m.useRef)(null),F=(0,m.useRef)(null),H=async()=>{f(!0);try{let e=await x.getPCRs();t(e)}catch(a){var e;console.error("Error fetching PCRs:",a),null===(e=E.current)||void 0===e||e.show({severity:"error",summary:"Error",detail:"ไม่สามารถดึงข้อมูล PCR",life:3e3})}finally{f(!1)}};(0,m.useEffect)(()=>{H()},[]);let Z=a.filter(e=>e.pcr_name.toLowerCase().includes(S.toLowerCase())),z=async()=>{if(P(!0),g.pcr_name.trim()){var a,t,l;f(!0);try{let l=g.approval_date instanceof Date?g.approval_date.toLocaleDateString("th-TH",{day:"2-digit",month:"long",year:"numeric"}):g.approval_date,s={pcr_name:g.pcr_name,approval_date:l,pcr_type:g.pcr_type,pcr_type_id:g.pcr_type_id};g.id?(await x.updatePCR(g.id,s),null===(a=E.current)||void 0===a||a.show({severity:"success",summary:"สำเร็จ",detail:"อัปเดต PCR แล้ว",life:3e3})):(await x.createPCR(s),null===(t=E.current)||void 0===t||t.show({severity:"success",summary:"สำเร็จ",detail:"เพิ่ม PCR แล้ว",life:3e3})),H(),d(!1),N(e)}catch(e){console.error(e),null===(l=E.current)||void 0===l||l.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{f(!1)}}},D=e=>{N({...e}),d(!0)},L=e=>{N(e),_(!0)},M=async()=>{var a,t;f(!0);try{await x.deletePCR(g.id),H(),_(!1),N(e),null===(a=E.current)||void 0===a||a.show({severity:"success",summary:"สำเร็จ",detail:"ลบ PCR แล้ว",life:3e3})}catch(e){console.error(e),null===(t=E.current)||void 0===t||t.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{f(!1)}},O=async()=>{var e,a;if(p){f(!0);try{await Promise.all(p.map(e=>x.deletePCR(e.id))),t(e=>e.filter(e=>!p.includes(e))),null===(e=E.current)||void 0===e||e.show({severity:"success",summary:"สำเร็จ",detail:"ลบรายการที่เลือกแล้ว",life:3e3}),u(null),w(!1)}catch(e){null===(a=E.current)||void 0===a||a.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{f(!1)}}};return(0,l.jsx)("div",{className:"grid",children:(0,l.jsx)("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"card p-4",children:[(0,l.jsx)(c.F,{ref:E}),(0,l.jsxs)("div",{className:"flex flex-column md:flex-row md:justify-content-between md:align-items-center gap-3",children:[(0,l.jsx)("h2",{className:"m-0",children:"จัดการ PCR"}),(0,l.jsxs)("div",{className:"flex flex-column md:flex-row gap-3",children:[(0,l.jsxs)("span",{className:"p-input-icon-left mr-3",children:[(0,l.jsx)("i",{className:"pi pi-search"}),(0,l.jsx)(n.o,{type:"search",placeholder:"ค้นหาด้วยชื่อ...",value:S,onChange:e=>k(e.target.value),className:"w-full"})]}),(0,l.jsx)(s.z,{label:"เพิ่มข้อกำหนดผลิตภัณฑ์",icon:"pi pi-plus",severity:"success",onClick:()=>{N(e),P(!1),d(!0)}})]})]}),(0,l.jsxs)(i.w,{ref:F,value:Z,selection:p,onSelectionChange:e=>u(e.value),dataKey:"id",paginator:!0,rows:10,rowsPerPageOptions:[5,10,25],globalFilter:R,emptyMessage:"ไม่พบข้อมูล",loading:v,responsiveLayout:"scroll",className:"mt-4",header:p&&p.length>0?(0,l.jsxs)("div",{className:"flex justify-content-between align-items-center",children:[(0,l.jsx)("span",{children:"เลือก ".concat(p.length," รายการ")}),(0,l.jsx)(s.z,{label:"ลบที่เลือก",icon:"pi pi-trash",severity:"danger",onClick:()=>w(!0)})]}):null,selectionMode:"checkbox",children:[(0,l.jsx)(r.s,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),(0,l.jsx)(r.s,{field:"index",header:"ลำดับ",body:(e,a)=>{let{rowIndex:t}=a;return t+1},style:{width:"80px"}}),(0,l.jsx)(r.s,{field:"pcr_name",header:"ชื่อ PCR",sortable:!0,style:{width:"300px"}}),(0,l.jsx)(r.s,{field:"approval_date",header:"วันที่อนุมัติ",sortable:!0,style:{width:"150px"}}),(0,l.jsx)(r.s,{field:"pcr_type",header:"ประเภท",sortable:!0,style:{width:"150px"}}),(0,l.jsx)(r.s,{body:e=>(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsx)(s.z,{icon:"pi pi-pencil",rounded:!0,severity:"success",onClick:()=>D(e),tooltip:"แก้ไข",tooltipOptions:{position:"top"}}),(0,l.jsx)(s.z,{icon:"pi pi-trash",rounded:!0,severity:"danger",onClick:()=>L(e),tooltip:"ลบ",tooltipOptions:{position:"top"}})]}),header:"การดำเนินการ",headerStyle:{width:"140px"},bodyStyle:{textAlign:"center"}})]}),(0,l.jsx)(h,{visible:o,pcr:g,submitted:b,onHide:()=>{P(!1),d(!1)},onChange:(e,a)=>{let t;t="target"in e?e.target.value:e.value,N({...g,[a]:t})},onSave:z}),(0,l.jsx)(y.Z,{visible:j,onHide:()=>{_(!1)},onConfirm:M,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(g.pcr_name,"?")}),(0,l.jsx)(y.Z,{visible:C,onHide:()=>{w(!1)},onConfirm:O,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(null==p?void 0:p.length," รายการที่เลือก?")})]})})})}}}]);