"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[713],{7713:function(e,i,l){l.r(i),l.d(i,{default:function(){return x}});var s=l(9268),t=l(6006),a=l(3702),n=l(8298),r=l(8176),d=l(315),o=l(8958),c=l(4390),u=l(3612),m=l(5942),h=e=>{let{visible:i,onHide:l,onSave:t,industrial:n,setIndustrial:r,submitted:o,cbamOptions:h}=e,p=(e,i)=>{let l=e.target.value;r(e=>e?{...e,[i]:l}:null)},v=(e,i)=>{let l=e.value;r(e=>e?{...e,[i]:l}:null)},f=(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(a.z,{label:"ยกเลิก",icon:"pi pi-times",outlined:!0,onClick:l}),(0,s.jsx)(a.z,{label:"บันทึก",icon:"pi pi-check",onClick:t})]});return(0,s.jsxs)(c.V,{visible:i,style:{width:"450px"},header:"รายละเอียดอุตสาหกรรม",modal:!0,className:"p-fluid",footer:f,onHide:l,children:[(0,s.jsxs)("div",{className:"field mt-3",children:[(0,s.jsx)("label",{htmlFor:"industrial_name",className:"font-bold",children:"ชื่ออุตสาหกรรม *"}),(0,s.jsx)(d.o,{id:"industrial_name",value:(null==n?void 0:n.industrial_name)||"",onChange:e=>p(e,"industrial_name"),required:!0,autoFocus:!0,className:(0,m.AK)({"p-invalid":o&&!(null==n?void 0:n.industrial_name)}),placeholder:"กรอกชื่ออุตสาหกรรม"}),o&&!(null==n?void 0:n.industrial_name)&&(0,s.jsx)("small",{className:"p-error",children:"จำเป็นต้องกรอกชื่ออุตสาหกรรม"})]}),(0,s.jsxs)("div",{className:"field mt-3",children:[(0,s.jsx)("label",{htmlFor:"required_cbam",className:"font-bold",children:"มี CBAM หรือไม่ *"}),(0,s.jsx)(u.L,{id:"required_cbam",value:null==n?void 0:n.required_cbam,options:h,onChange:e=>v(e,"required_cbam"),optionLabel:"label",optionValue:"value",placeholder:"เลือกสถานะ CBAM",className:(0,m.AK)({"p-invalid":o&&(null==n?void 0:n.required_cbam)===void 0})}),o&&(null==n?void 0:n.required_cbam)===void 0&&(0,s.jsx)("small",{className:"p-error",children:"จำเป็นต้องเลือกสถานะ CBAM"})]})]})},p=l(2494);let v="http://178.128.123.212:5000/api/v1/admin/industrials";function f(e){return{industrial_id:e.industrial_id,industrial_name:e.industrial_name,required_cbam:e.required_cbam}}let y={getIndustrials:()=>fetch(v,{headers:{"Cache-Control":"no-cache"}}).then(e=>e.ok?e.json():Promise.reject(e)).then(e=>e.map(f)),getIndustrialById:e=>fetch("".concat(v,"/").concat(e),{headers:{"Cache-Control":"no-cache"}}).then(e=>e.ok?e.json():Promise.reject(e)).then(f),createIndustrial:e=>fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.ok?e.json():Promise.reject(e)).then(f),updateUnit:e=>fetch("".concat(v,"/").concat(e.industrial_id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.ok?e.json():Promise.reject(e)).then(f),deleteUnit:e=>fetch("".concat(v,"/").concat(e),{method:"DELETE"}).then(e=>e.ok?e.json():Promise.reject(e))};var x=()=>{let[e,i]=(0,t.useState)([]),[l,c]=(0,t.useState)(null),[u,m]=(0,t.useState)(null),[v,f]=(0,t.useState)(!1),[x]=(0,t.useState)(""),[j,b]=(0,t.useState)(""),[_,w]=(0,t.useState)(!1),[g,C]=(0,t.useState)(!1),[N,S]=(0,t.useState)(!1),[k,q]=(0,t.useState)(!1),E=(0,t.useRef)(null),P=(0,t.useRef)(null),A={industrial_id:0,industrial_name:"",required_cbam:0};(0,t.useEffect)(()=>{I()},[]);let I=async()=>{f(!0);try{let e=await y.getIndustrials();i(e)}catch(i){var e;null===(e=E.current)||void 0===e||e.show({severity:"error",summary:"Error",detail:"ไม่สามารถโหลดข้อมูลได้",life:3e3})}finally{f(!1)}},M=e.filter(e=>{var i;return null===(i=e.industrial_name)||void 0===i?void 0:i.toLowerCase().includes(j.toLowerCase())}),O=async()=>{var e,s,t;if(q(!0),l&&l.industrial_name.trim()){f(!0);try{if(l.industrial_id&&l.industrial_id>0){let s=await y.updateUnit(l);i(e=>e.map(e=>e.industrial_id===s.industrial_id?s:e)),null===(e=E.current)||void 0===e||e.show({severity:"success",summary:"สำเร็จ",detail:"แก้ไขข้อมูลแล้ว",life:3e3})}else{let e=await y.createIndustrial(l);i(i=>[...i,e]),null===(s=E.current)||void 0===s||s.show({severity:"success",summary:"สำเร็จ",detail:"เพิ่มอุตสาหกรรมแล้ว",life:3e3})}I(),w(!1),c(null),q(!1)}catch(e){null===(t=E.current)||void 0===t||t.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{f(!1)}}},z=e=>{c({...e}),w(!0)},L=e=>{c(e),C(!0)},U=async()=>{var e,s;if(l){f(!0);try{await y.deleteUnit(l.industrial_id),i(e=>e.filter(e=>e.industrial_id!==l.industrial_id)),null===(e=E.current)||void 0===e||e.show({severity:"success",summary:"สำเร็จ",detail:"ลบอุตสาหกรรมแล้ว",life:3e3}),c(null),C(!1)}catch(e){null===(s=E.current)||void 0===s||s.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{f(!1)}}},B=async()=>{var e,l;if(u){f(!0);try{await Promise.all(u.map(e=>y.deleteUnit(e.industrial_id))),i(e=>e.filter(e=>!u.includes(e))),null===(e=E.current)||void 0===e||e.show({severity:"success",summary:"สำเร็จ",detail:"ลบรายการที่เลือกแล้ว",life:3e3}),m(null),S(!1)}catch(e){null===(l=E.current)||void 0===l||l.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{f(!1)}}};return(0,s.jsx)("div",{className:"grid",children:(0,s.jsx)("div",{className:"col-12",children:(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)(o.F,{ref:E}),(0,s.jsxs)("div",{className:"flex flex-column md:flex-row md:justify-content-between md:align-items-center gap-3",children:[(0,s.jsx)("h2",{className:"m-0",children:"จัดการอุตสาหกรรม"}),(0,s.jsxs)("div",{className:"flex flex-column md:flex-row gap-3 w-full md:w-auto",children:[(0,s.jsxs)("span",{className:"p-input-icon-left mr-3",children:[(0,s.jsx)("i",{className:"pi pi-search"}),(0,s.jsx)(d.o,{type:"search",placeholder:"ค้นหาด้วยชื่อ...",value:j,onChange:e=>b(e.target.value),className:"w-full"})]}),(0,s.jsx)(a.z,{label:"เพิ่มอุตสาหกรรม",icon:"pi pi-plus",severity:"success",onClick:()=>{c({...A}),q(!1),w(!0)}})]})]}),(0,s.jsxs)(r.w,{ref:P,value:M,selection:u,onSelectionChange:e=>m(e.value),dataKey:"industrial_id",paginator:!0,rows:10,rowsPerPageOptions:[5,10,25],globalFilter:x,emptyMessage:"ไม่พบข้อมูล",loading:v,responsiveLayout:"scroll",className:"mt-4",header:u&&u.length>0?(0,s.jsxs)("div",{className:"flex justify-content-between align-items-center",children:[(0,s.jsx)("span",{children:"เลือก ".concat(u.length," รายการ")}),(0,s.jsx)(a.z,{label:"ลบที่เลือก",icon:"pi pi-trash",severity:"danger",onClick:()=>S(!0)})]}):null,selectionMode:u?"checkbox":null,children:[(0,s.jsx)(n.s,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),(0,s.jsx)(n.s,{field:"index",header:"ลำดับ",body:(e,i)=>{let{rowIndex:l}=i;return l+1},style:{width:"100px"}}),(0,s.jsx)(n.s,{field:"industrial_name",header:"ชื่ออุตสาหกรรม",style:{width:"200px"}}),(0,s.jsx)(n.s,{field:"required_cbam",header:"มี CBAM หรือไม่",sortable:!0,body:e=>1===e.required_cbam?"มี":"ไม่มี",style:{width:"150px"}}),(0,s.jsx)(n.s,{body:e=>(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)(a.z,{icon:"pi pi-pencil",rounded:!0,severity:"success",onClick:()=>z(e),tooltip:"แก้ไข",tooltipOptions:{position:"top"}}),(0,s.jsx)(a.z,{icon:"pi pi-trash",rounded:!0,severity:"danger",onClick:()=>L(e),tooltip:"ลบ",tooltipOptions:{position:"top"}})]}),header:"การดำเนินการ",headerStyle:{width:"100px"},bodyStyle:{textAlign:"center"}})]}),(0,s.jsx)(h,{visible:_,onHide:()=>{q(!1),w(!1),c(null)},onSave:O,industrial:l,setIndustrial:c,submitted:k,cbamOptions:[{label:"มี",value:1},{label:"ไม่มี",value:0}]}),(0,s.jsx)(p.Z,{visible:g,onHide:()=>C(!1),onConfirm:U,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(null==l?void 0:l.industrial_name,"?")}),(0,s.jsx)(p.Z,{visible:N,onHide:()=>S(!1),onConfirm:B,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(null==u?void 0:u.length," รายการที่เลือก?")})]})})})}}}]);