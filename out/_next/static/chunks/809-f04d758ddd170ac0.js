"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[809],{3809:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var s=a(9268),l=a(6006),r=a(3702),n=a(8298),i=a(8176),o=a(315),d=a(8958),c=a(4390),u=a(1262),h=a(3142),m=a(3612),p=a(5942);function v(e){var t;let{visible:a,round:l,submitted:n,onHide:i,onChange:d,onSave:h}=e,v=(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(r.z,{label:"ยกเลิก",icon:"pi pi-times",outlined:!0,onClick:i}),(0,s.jsx)(r.z,{label:"บันทึก",icon:"pi pi-check",onClick:h})]});return(0,s.jsxs)(c.V,{visible:a,style:{width:"500px"},header:"รายละเอียดรอบลงทะเบียน",modal:!0,className:"p-fluid",footer:v,onHide:i,children:[(0,s.jsxs)("div",{className:"field mt-3",children:[(0,s.jsx)("label",{htmlFor:"quarter",className:"font-bold",children:"รอบ *"}),(0,s.jsx)(o.o,{id:"quarter",value:(null==l?void 0:l.quarter)||"",onChange:e=>d(e,"quarter"),required:!0,autoFocus:!0,className:(0,p.AK)({"p-invalid":n&&!(null==l?void 0:l.quarter)}),placeholder:"กรอกรอบ"}),n&&!(null==l?void 0:l.quarter)&&(0,s.jsx)("small",{className:"p-error",children:"จำเป็นต้องกรอกรอบลงทะเบียน"})]}),(0,s.jsxs)("div",{className:"field mt-3",children:[(0,s.jsx)("label",{htmlFor:"start",className:"font-bold",children:"วันเริ่มต้น *"}),(0,s.jsx)(u.f,{id:"start",value:(null==l?void 0:l.start)?new Date(l.start):null,onChange:e=>{let t=e.value instanceof Date?e.value:null;d({value:t?t.toISOString().split("T")[0]:""},"start")},showIcon:!0,dateFormat:"dd/mm/yy",yearRange:"2500:2600",locale:"th-TH",className:(0,p.AK)({"p-invalid":n&&!(null==l?void 0:l.start)}),placeholder:"เลือกวันเริ่มต้น"}),n&&!(null==l?void 0:l.start)&&(0,s.jsx)("small",{className:"p-error",children:"จำเป็นต้องเลือกวันเริ่มต้น"})]}),(0,s.jsxs)("div",{className:"field mt-3",children:[(0,s.jsx)("label",{htmlFor:"end",className:"font-bold",children:"วันสิ้นสุด *"}),(0,s.jsx)(u.f,{id:"end",value:(null==l?void 0:l.end)?new Date(l.end):null,onChange:e=>{let t=e.value instanceof Date?e.value:null;d({value:t?t.toISOString().split("T")[0]:""},"end")},showIcon:!0,dateFormat:"dd/mm/yy",yearRange:"2500:2600",locale:"th-TH",className:(0,p.AK)({"p-invalid":n&&!(null==l?void 0:l.start)}),placeholder:"เลือกวันเริ่มต้น"}),n&&!(null==l?void 0:l.end)&&(0,s.jsx)("small",{className:"p-error",children:"จำเป็นต้องเลือกวันสิ้นสุด"})]}),(0,s.jsxs)("div",{className:"field mt-3",children:[(0,s.jsx)("label",{htmlFor:"status",className:"font-bold",children:"สถานะ *"}),(0,s.jsx)(m.L,{id:"status",value:null!==(t=null==l?void 0:l.status)&&void 0!==t?t:"",options:[{label:"ใช้งาน",value:1},{label:"ไม่ใช้งาน",value:0}],onChange:e=>d(e,"status"),optionLabel:"label",optionValue:"value",placeholder:"เลือกสถานะ",className:(0,p.AK)({"p-invalid":n&&(null==l?void 0:l.status)===void 0})}),n&&(null==l?void 0:l.status)===void 0&&(0,s.jsx)("small",{className:"p-error",children:"จำเป็นต้องเลือกสถานะ"})]})]})}(0,h.b4)("th-TH",{firstDayOfWeek:0,dayNames:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"],dayNamesShort:["อา","จ","อ","พ","พฤ","ศ","ส"],dayNamesMin:["อา","จ","อ","พ","พฤ","ศ","ส"],monthNames:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],monthNamesShort:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],today:"วันนี้",clear:"ลบ"});var f=a(2494);let y="http://178.128.123.212:5000/api/v1/admin/rounds";function x(e){return{id:e.id,quarter:e.quarter,start:e.start,end:e.end,status:e.status}}let j={getRounds:()=>fetch(y,{headers:{"Cache-Control":"no-cache"}}).then(e=>{if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json()}).then(e=>e.map(x)),getRoundById:e=>fetch("".concat(y,"/").concat(e),{headers:{"Cache-Control":"no-cache"}}).then(e=>{if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json()}).then(x),createRound:e=>fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json().then(x)}),updateRound:(e,t)=>fetch("".concat(y,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>{if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json().then(x)}),deleteRound:e=>fetch("".concat(y,"/").concat(e),{method:"DELETE"}).then(e=>{if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return!0})};var g=()=>{let e={id:0,quarter:"",start:"",end:"",status:1},[t,a]=(0,l.useState)([]),[c,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)(""),[p,y]=(0,l.useState)(!1),[x,g]=(0,l.useState)(!1),[w,N]=(0,l.useState)(!1),[b,S]=(0,l.useState)(e),[C,T]=(0,l.useState)(!1),[k,q]=(0,l.useState)([]),R=(0,l.useRef)(null),E=(0,l.useRef)(null),H=async()=>{u(!0);try{let e=await j.getRounds(),t=e.map(e=>({...e,start:e.start||"",end:e.end||""}));a(t)}catch(e){console.error("Fetch rounds error:",e)}finally{u(!1)}};(0,l.useEffect)(()=>{H()},[]);let F=e=>{if(!e)return"";let t=e instanceof Date?e:new Date(e),a=t.getDate().toString().padStart(2,"0"),s=(t.getMonth()+1).toString().padStart(2,"0"),l=t.getFullYear()+543;return"".concat(a,"/").concat(s,"/").concat(l)},P=async()=>{var s,l,r;if(T(!0),b.quarter.trim()){u(!0);try{let r={...b,start:F(b.start),end:F(b.end)};if(b.id&&0!==b.id){let e=await j.updateRound(b.id,r);a(t=>t.map(t=>t.id===e.id?e:t)),null===(s=R.current)||void 0===s||s.show({severity:"success",summary:"สำเร็จ",detail:"แก้ไขรอบแล้ว",life:3e3})}else{let e=t.length?Math.max(...t.map(e=>e.id)):0,s={...r,id:e+1},n=await j.createRound(s);a(e=>[...e,n]),null===(l=R.current)||void 0===l||l.show({severity:"success",summary:"สำเร็จ",detail:"เพิ่มรอบแล้ว",life:3e3})}H(),y(!1),S(e),T(!1)}catch(e){console.error(e),null===(r=R.current)||void 0===r||r.show({severity:"error",summary:"ผิดพลาด",detail:"บันทึกรอบไม่สำเร็จ",life:3e3})}finally{u(!1)}}},D=async()=>{var s,l;if(b.id){u(!0);try{await j.deleteRound(b.id),a(t.filter(e=>e.id!==b.id)),null===(s=R.current)||void 0===s||s.show({severity:"success",summary:"สำเร็จ",detail:"ลบรอบแล้ว",life:3e3})}catch(e){console.error(e),null===(l=R.current)||void 0===l||l.show({severity:"error",summary:"ผิดพลาด",detail:"ไม่สามารถลบรอบได้",life:3e3})}finally{g(!1),S(e),u(!1)}}},O=async()=>{var e,s;if(k){u(!0);try{await Promise.all(k.map(e=>j.deleteRound(e.id))),a(t.filter(e=>!k.includes(e))),null===(e=R.current)||void 0===e||e.show({severity:"success",summary:"สำเร็จ",detail:"ลบข้อมูลที่เลือกแล้ว",life:3e3})}catch(e){null===(s=R.current)||void 0===s||s.show({severity:"error",summary:"Error",detail:"เกิดข้อผิดพลาด",life:3e3})}finally{N(!1),q(null),u(!1)}}},z=e=>{S(e),g(!0)},I=e=>{S({...e,start:e.start?e.start:"",end:e.end?e.end:""}),y(!0)},L=t.filter(e=>{var t;return null===(t=e.quarter)||void 0===t?void 0:t.toLowerCase().includes(h.toLowerCase())});return(0,s.jsx)("div",{className:"grid",children:(0,s.jsx)("div",{className:"col-12",children:(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)(d.F,{ref:R}),(0,s.jsxs)("div",{className:"flex flex-column md:flex-row md:justify-content-between md:align-items-center gap-3 mb-4",children:[(0,s.jsx)("h2",{className:"m-0",children:"จัดการรอบลงทะเบียน"}),(0,s.jsxs)("div",{className:"flex flex-column md:flex-row gap-3 w-full md:w-auto",children:[(0,s.jsxs)("span",{className:"p-input-icon-left",children:[(0,s.jsx)("i",{className:"pi pi-search"}),(0,s.jsx)(o.o,{type:"search",onInput:e=>m(e.currentTarget.value),placeholder:"ค้นหารอบ...",className:"w-full"})]}),(0,s.jsx)(r.z,{label:"เพิ่มรอบ",icon:"pi pi-plus",severity:"success",onClick:()=>{S(e),T(!1),y(!0)}})]})]}),(0,s.jsxs)(i.w,{ref:E,value:L,selection:k,onSelectionChange:e=>q(e.value),dataKey:"id",paginator:!0,rows:10,rowsPerPageOptions:[5,10,25],emptyMessage:"ไม่พบข้อมูล",loading:c,responsiveLayout:"scroll",className:"mt-4",header:k&&k.length>0?(0,s.jsxs)("div",{className:"flex justify-content-between align-items-center",children:[(0,s.jsx)("span",{children:"เลือก ".concat(k.length," รายการ")}),(0,s.jsx)(r.z,{label:"ลบที่เลือก",icon:"pi pi-trash",severity:"danger",onClick:()=>N(!0)})]}):null,selectionMode:"multiple",children:[(0,s.jsx)(n.s,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),(0,s.jsx)(n.s,{field:"quarter",header:"รอบ",sortable:!0,style:{width:"200px"}}),(0,s.jsx)(n.s,{field:"start",header:"วันเริ่มต้น",sortable:!0,style:{width:"150px"}}),(0,s.jsx)(n.s,{field:"end",header:"วันสิ้นสุด",sortable:!0,style:{width:"150px"}}),(0,s.jsx)(n.s,{field:"status",header:"สถานะ",sortable:!0,body:e=>(0,s.jsx)("span",{className:"p-tag p-component p-tag-".concat(1===e.status?"success":"danger"),children:1===e.status?"ใช้งาน":"ไม่ใช้งาน"}),style:{width:"150px"}}),(0,s.jsx)(n.s,{body:e=>(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)(r.z,{icon:"pi pi-pencil",rounded:!0,severity:"success",onClick:()=>I(e),tooltip:"แก้ไข",tooltipOptions:{position:"top"}}),(0,s.jsx)(r.z,{icon:"pi pi-trash",rounded:!0,severity:"danger",onClick:()=>z(e),tooltip:"ลบ",tooltipOptions:{position:"top"}})]}),header:"การดำเนินการ",headerStyle:{width:"100px"},bodyStyle:{textAlign:"center"}})]}),(0,s.jsx)(v,{visible:p,round:b,submitted:C,onHide:()=>{T(!1),y(!1),S(e)},onChange:(e,t)=>{let a="target"in e?e.target.value:e.value;S(e=>({...e,[t]:a}))},onSave:P}),(0,s.jsx)(f.Z,{visible:x,onHide:()=>{g(!1)},onConfirm:D,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(b.quarter,"?")}),(0,s.jsx)(f.Z,{visible:w,onHide:()=>{N(!1)},onConfirm:O,message:"คุณแน่ใจหรือไม่ว่าต้องการลบ ".concat(null==k?void 0:k.length," รายการที่เลือก?")})]})})})}}}]);